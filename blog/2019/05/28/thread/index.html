
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Android Thread解析 - Solarex's Blog</title>
  <meta name="author" content="Solarex">

  
  <meta name="description" content="本文主要分析Android平台上的Thread类源码，分为Java部分和native部分。 Java部分比较简单，大致过下各个方法吧。 线程创建 1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28 &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://Solarex.github.io/blog/2019/05/28/thread/">
  <link href="/favicon.ico" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/javascripts/ender.js"></script>
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/lib/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="/atom.xml" rel="alternate" title="Solarex's Blog" type="application/atom+xml">
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<script>
    var _hmt = _hmt || [];
    (function() {
          var hm = document.createElement("script");
            hm.src = "https://hm.baidu.com/hm.js?2574e8b2c205dfe8ff89e239fa38ca27";
              var s = document.getElementsByTagName("script")[0]; 
                s.parentNode.insertBefore(hm, s);
    })();
</script>

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-42746457-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">Solarex's Blog</a></h1>
  
    <h2>我只想过，平平淡淡的生活，欲望啊，请放过脆弱的我</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:Solarex.github.io" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
  <li><a href="http://solarex.github.io/wiki">Wiki</a></li>
  <li><a href="/projects">Project</a></li>
  <li><a href="http://solarex.github.io/resume">Resume</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">Android Thread解析</h1>
    
    
      <p class="meta">
        








  


<time datetime="2019-05-28T16:58:00+08:00" pubdate data-updated="true">May 28<span>th</span>, 2019</time>
        
         | <a href="#disqus_thread">Comments</a>
        
      </p>
    
  </header>


<div class="entry-content"><p>本文主要分析Android平台上的Thread类源码，分为Java部分和native部分。</p>

<!-- more -->


<p>Java部分比较简单，大致过下各个方法吧。</p>

<h3>线程创建</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="cm">/**</span>
</span><span class='line'><span class="cm"> * Initializes a Thread.</span>
</span><span class='line'><span class="cm"> *</span>
</span><span class='line'><span class="cm"> * @param g the Thread group</span>
</span><span class='line'><span class="cm"> * @param target the object whose run() method gets called</span>
</span><span class='line'><span class="cm"> * @param name the name of the new Thread</span>
</span><span class='line'><span class="cm"> * @param stackSize the desired stack size for the new thread, or</span>
</span><span class='line'><span class="cm"> *        zero to indicate that this parameter is to be ignored.</span>
</span><span class='line'><span class="cm"> */</span>
</span><span class='line'><span class="kd">private</span> <span class="kt">void</span> <span class="nf">init</span><span class="o">(</span><span class="n">ThreadGroup</span> <span class="n">g</span><span class="o">,</span> <span class="n">Runnable</span> <span class="n">target</span><span class="o">,</span> <span class="n">String</span> <span class="n">name</span><span class="o">,</span> <span class="kt">long</span> <span class="n">stackSize</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>    <span class="n">Thread</span> <span class="n">parent</span> <span class="o">=</span> <span class="n">currentThread</span><span class="o">();</span>
</span><span class='line'>    <span class="k">if</span> <span class="o">(</span><span class="n">g</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>        <span class="n">g</span> <span class="o">=</span> <span class="n">parent</span><span class="o">.</span><span class="na">getThreadGroup</span><span class="o">();</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">g</span><span class="o">.</span><span class="na">addUnstarted</span><span class="o">();</span>
</span><span class='line'>    <span class="k">this</span><span class="o">.</span><span class="na">group</span> <span class="o">=</span> <span class="n">g</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">this</span><span class="o">.</span><span class="na">target</span> <span class="o">=</span> <span class="n">target</span><span class="o">;</span>
</span><span class='line'>    <span class="k">this</span><span class="o">.</span><span class="na">priority</span> <span class="o">=</span> <span class="n">parent</span><span class="o">.</span><span class="na">getPriority</span><span class="o">();</span>
</span><span class='line'>    <span class="k">this</span><span class="o">.</span><span class="na">daemon</span> <span class="o">=</span> <span class="n">parent</span><span class="o">.</span><span class="na">isDaemon</span><span class="o">();</span>
</span><span class='line'>    <span class="n">setName</span><span class="o">(</span><span class="n">name</span><span class="o">);</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">init2</span><span class="o">(</span><span class="n">parent</span><span class="o">);</span>
</span><span class='line'>
</span><span class='line'>    <span class="cm">/* Stash the specified stack size in case the VM cares */</span>
</span><span class='line'>    <span class="k">this</span><span class="o">.</span><span class="na">stackSize</span> <span class="o">=</span> <span class="n">stackSize</span><span class="o">;</span>
</span><span class='line'>    <span class="n">tid</span> <span class="o">=</span> <span class="n">nextThreadID</span><span class="o">();</span>
</span><span class='line'><span class="o">}</span>
</span><span class='line'><span class="kd">private</span> <span class="kt">void</span> <span class="nf">init2</span><span class="o">(</span><span class="n">Thread</span> <span class="n">parent</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>    <span class="k">this</span><span class="o">.</span><span class="na">contextClassLoader</span> <span class="o">=</span> <span class="n">parent</span><span class="o">.</span><span class="na">getContextClassLoader</span><span class="o">();</span>
</span><span class='line'>    <span class="k">this</span><span class="o">.</span><span class="na">inheritedAccessControlContext</span> <span class="o">=</span> <span class="n">AccessController</span><span class="o">.</span><span class="na">getContext</span><span class="o">();</span>
</span><span class='line'>    <span class="k">if</span> <span class="o">(</span><span class="n">parent</span><span class="o">.</span><span class="na">inheritableThreadLocals</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>        <span class="k">this</span><span class="o">.</span><span class="na">inheritableThreadLocals</span> <span class="o">=</span> <span class="n">ThreadLocal</span><span class="o">.</span><span class="na">createInheritedMap</span><span class="o">(</span>
</span><span class='line'>                <span class="n">parent</span><span class="o">.</span><span class="na">inheritableThreadLocals</span><span class="o">);</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>线程<code>NEW</code>出来的时候只是从创建它的线程那里继承一些属性，比如threadgroup，daemon状态，priority，stacksize，inheritableThreadLocals之类的。真正启动线程是在<code>start</code>方法里。</p>

<h3>线程启动</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="cm">/**</span>
</span><span class='line'><span class="cm">     * Causes this thread to begin execution; the Java Virtual Machine</span>
</span><span class='line'><span class="cm">     * calls the &lt;code&gt;run&lt;/code&gt; method of this thread.</span>
</span><span class='line'><span class="cm">     * &lt;p&gt;</span>
</span><span class='line'><span class="cm">     * The result is that two threads are running concurrently: the</span>
</span><span class='line'><span class="cm">     * current thread (which returns from the call to the</span>
</span><span class='line'><span class="cm">     * &lt;code&gt;start&lt;/code&gt; method) and the other thread (which executes its</span>
</span><span class='line'><span class="cm">     * &lt;code&gt;run&lt;/code&gt; method).</span>
</span><span class='line'><span class="cm">     * &lt;p&gt;</span>
</span><span class='line'><span class="cm">     * It is never legal to start a thread more than once.</span>
</span><span class='line'><span class="cm">     * In particular, a thread may not be restarted once it has completed</span>
</span><span class='line'><span class="cm">     * execution.</span>
</span><span class='line'><span class="cm">     *</span>
</span><span class='line'><span class="cm">     * @exception  IllegalThreadStateException  if the thread was already</span>
</span><span class='line'><span class="cm">     *               started.</span>
</span><span class='line'><span class="cm">     * @see        #run()</span>
</span><span class='line'><span class="cm">     * @see        #stop()</span>
</span><span class='line'><span class="cm">     */</span>
</span><span class='line'>    <span class="kd">public</span> <span class="kd">synchronized</span> <span class="kt">void</span> <span class="nf">start</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>        <span class="cm">/**</span>
</span><span class='line'><span class="cm">         * This method is not invoked for the main method thread or &quot;system&quot;</span>
</span><span class='line'><span class="cm">         * group threads created/set up by the VM. Any new functionality added</span>
</span><span class='line'><span class="cm">         * to this method in the future may have to also be added to the VM.</span>
</span><span class='line'><span class="cm">         *</span>
</span><span class='line'><span class="cm">         * A zero status value corresponds to state &quot;NEW&quot;.</span>
</span><span class='line'><span class="cm">         */</span>
</span><span class='line'>        <span class="c1">// Android-changed: throw if &#39;started&#39; is true</span>
</span><span class='line'>        <span class="k">if</span> <span class="o">(</span><span class="n">threadStatus</span> <span class="o">!=</span> <span class="mi">0</span> <span class="o">||</span> <span class="n">started</span><span class="o">)</span>
</span><span class='line'>            <span class="k">throw</span> <span class="k">new</span> <span class="nf">IllegalThreadStateException</span><span class="o">();</span>
</span><span class='line'>
</span><span class='line'>        <span class="cm">/* Notify the group that this thread is about to be started</span>
</span><span class='line'><span class="cm">         * so that it can be added to the group&#39;s list of threads</span>
</span><span class='line'><span class="cm">         * and the group&#39;s unstarted count can be decremented. */</span>
</span><span class='line'>        <span class="n">group</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="k">this</span><span class="o">);</span>
</span><span class='line'>
</span><span class='line'>        <span class="n">started</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>
</span><span class='line'>        <span class="k">try</span> <span class="o">{</span>
</span><span class='line'>            <span class="n">nativeCreate</span><span class="o">(</span><span class="k">this</span><span class="o">,</span> <span class="n">stackSize</span><span class="o">,</span> <span class="n">daemon</span><span class="o">);</span>
</span><span class='line'>            <span class="n">started</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>
</span><span class='line'>        <span class="o">}</span> <span class="k">finally</span> <span class="o">{</span>
</span><span class='line'>            <span class="k">try</span> <span class="o">{</span>
</span><span class='line'>                <span class="k">if</span> <span class="o">(!</span><span class="n">started</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>                    <span class="n">group</span><span class="o">.</span><span class="na">threadStartFailed</span><span class="o">(</span><span class="k">this</span><span class="o">);</span>
</span><span class='line'>                <span class="o">}</span>
</span><span class='line'>            <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">Throwable</span> <span class="n">ignore</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>                <span class="cm">/* do nothing. If start0 threw a Throwable then</span>
</span><span class='line'><span class="cm">                  it will be passed up the call stack */</span>
</span><span class='line'>            <span class="o">}</span>
</span><span class='line'>        <span class="o">}</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">private</span> <span class="kd">native</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">nativeCreate</span><span class="o">(</span><span class="n">Thread</span> <span class="n">t</span><span class="o">,</span> <span class="kt">long</span> <span class="n">stackSize</span><span class="o">,</span> <span class="kt">boolean</span> <span class="n">daemon</span><span class="o">);</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
<span class='line-number'>98</span>
<span class='line-number'>99</span>
<span class='line-number'>100</span>
<span class='line-number'>101</span>
<span class='line-number'>102</span>
</pre></td><td class='code'><pre><code class='c++'><span class='line'><span class="c1">// http://androidxref.com/9.0.0_r3/xref/art/runtime/thread.cc#623</span>
</span><span class='line'><span class="kt">void</span> <span class="n">Thread</span><span class="o">::</span><span class="n">CreateNativeThread</span><span class="p">(</span><span class="n">JNIEnv</span><span class="o">*</span> <span class="n">env</span><span class="p">,</span> <span class="n">jobject</span> <span class="n">java_peer</span><span class="p">,</span> <span class="n">size_t</span> <span class="n">stack_size</span><span class="p">,</span> <span class="kt">bool</span> <span class="n">is_daemon</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="n">CHECK</span><span class="p">(</span><span class="n">java_peer</span> <span class="o">!=</span> <span class="n">nullptr</span><span class="p">);</span>
</span><span class='line'>  <span class="n">Thread</span><span class="o">*</span> <span class="n">self</span> <span class="o">=</span> <span class="k">static_cast</span><span class="o">&lt;</span><span class="n">JNIEnvExt</span><span class="o">*&gt;</span><span class="p">(</span><span class="n">env</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">GetSelf</span><span class="p">();</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">if</span> <span class="p">(</span><span class="n">VLOG_IS_ON</span><span class="p">(</span><span class="n">threads</span><span class="p">))</span> <span class="p">{</span>
</span><span class='line'>    <span class="n">ScopedObjectAccess</span> <span class="n">soa</span><span class="p">(</span><span class="n">env</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">ArtField</span><span class="o">*</span> <span class="n">f</span> <span class="o">=</span> <span class="n">jni</span><span class="o">::</span><span class="n">DecodeArtField</span><span class="p">(</span><span class="n">WellKnownClasses</span><span class="o">::</span><span class="n">java_lang_Thread_name</span><span class="p">);</span>
</span><span class='line'>    <span class="n">ObjPtr</span><span class="o">&lt;</span><span class="n">mirror</span><span class="o">::</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">java_name</span> <span class="o">=</span>
</span><span class='line'>        <span class="n">f</span><span class="o">-&gt;</span><span class="n">GetObject</span><span class="p">(</span><span class="n">soa</span><span class="p">.</span><span class="n">Decode</span><span class="o">&lt;</span><span class="n">mirror</span><span class="o">::</span><span class="n">Object</span><span class="o">&gt;</span><span class="p">(</span><span class="n">java_peer</span><span class="p">))</span><span class="o">-&gt;</span><span class="n">AsString</span><span class="p">();</span>
</span><span class='line'>    <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">thread_name</span><span class="p">;</span>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span><span class="n">java_name</span> <span class="o">!=</span> <span class="n">nullptr</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="n">thread_name</span> <span class="o">=</span> <span class="n">java_name</span><span class="o">-&gt;</span><span class="n">ToModifiedUtf8</span><span class="p">();</span>
</span><span class='line'>    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span><span class='line'>      <span class="n">thread_name</span> <span class="o">=</span> <span class="s">&quot;(Unnamed)&quot;</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">VLOG</span><span class="p">(</span><span class="n">threads</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;Creating native thread for &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">thread_name</span><span class="p">;</span>
</span><span class='line'>    <span class="n">self</span><span class="o">-&gt;</span><span class="n">Dump</span><span class="p">(</span><span class="n">LOG_STREAM</span><span class="p">(</span><span class="n">INFO</span><span class="p">));</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">Runtime</span><span class="o">*</span> <span class="n">runtime</span> <span class="o">=</span> <span class="n">Runtime</span><span class="o">::</span><span class="n">Current</span><span class="p">();</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">// Atomically start the birth of the thread ensuring the runtime isn&#39;t shutting down.</span>
</span><span class='line'>  <span class="kt">bool</span> <span class="n">thread_start_during_shutdown</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
</span><span class='line'>  <span class="p">{</span>
</span><span class='line'>    <span class="n">MutexLock</span> <span class="n">mu</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="o">*</span><span class="n">Locks</span><span class="o">::</span><span class="n">runtime_shutdown_lock_</span><span class="p">);</span>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span><span class="n">runtime</span><span class="o">-&gt;</span><span class="n">IsShuttingDownLocked</span><span class="p">())</span> <span class="p">{</span>
</span><span class='line'>      <span class="n">thread_start_during_shutdown</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span><span class='line'>      <span class="n">runtime</span><span class="o">-&gt;</span><span class="n">StartThreadBirth</span><span class="p">();</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>  <span class="k">if</span> <span class="p">(</span><span class="n">thread_start_during_shutdown</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="n">ScopedLocalRef</span><span class="o">&lt;</span><span class="n">jclass</span><span class="o">&gt;</span> <span class="n">error_class</span><span class="p">(</span><span class="n">env</span><span class="p">,</span> <span class="n">env</span><span class="o">-&gt;</span><span class="n">FindClass</span><span class="p">(</span><span class="s">&quot;java/lang/InternalError&quot;</span><span class="p">));</span>
</span><span class='line'>    <span class="n">env</span><span class="o">-&gt;</span><span class="n">ThrowNew</span><span class="p">(</span><span class="n">error_class</span><span class="p">.</span><span class="n">get</span><span class="p">(),</span> <span class="s">&quot;Thread starting during runtime shutdown&quot;</span><span class="p">);</span>
</span><span class='line'>    <span class="k">return</span><span class="p">;</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">Thread</span><span class="o">*</span> <span class="n">child_thread</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Thread</span><span class="p">(</span><span class="n">is_daemon</span><span class="p">);</span>
</span><span class='line'>  <span class="c1">// Use global JNI ref to hold peer live while child thread starts.</span>
</span><span class='line'>  <span class="n">child_thread</span><span class="o">-&gt;</span><span class="n">tlsPtr_</span><span class="p">.</span><span class="n">jpeer</span> <span class="o">=</span> <span class="n">env</span><span class="o">-&gt;</span><span class="n">NewGlobalRef</span><span class="p">(</span><span class="n">java_peer</span><span class="p">);</span>
</span><span class='line'>  <span class="n">stack_size</span> <span class="o">=</span> <span class="n">FixStackSize</span><span class="p">(</span><span class="n">stack_size</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">// Thread.start is synchronized, so we know that nativePeer is 0, and know that we&#39;re not racing</span>
</span><span class='line'>  <span class="c1">// to assign it.</span>
</span><span class='line'>  <span class="n">env</span><span class="o">-&gt;</span><span class="n">SetLongField</span><span class="p">(</span><span class="n">java_peer</span><span class="p">,</span> <span class="n">WellKnownClasses</span><span class="o">::</span><span class="n">java_lang_Thread_nativePeer</span><span class="p">,</span>
</span><span class='line'>                    <span class="k">reinterpret_cast</span><span class="o">&lt;</span><span class="n">jlong</span><span class="o">&gt;</span><span class="p">(</span><span class="n">child_thread</span><span class="p">));</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">// Try to allocate a JNIEnvExt for the thread. We do this here as we might be out of memory and</span>
</span><span class='line'>  <span class="c1">// do not have a good way to report this on the child&#39;s side.</span>
</span><span class='line'>  <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">error_msg</span><span class="p">;</span>
</span><span class='line'>  <span class="n">std</span><span class="o">::</span><span class="n">unique_ptr</span><span class="o">&lt;</span><span class="n">JNIEnvExt</span><span class="o">&gt;</span> <span class="n">child_jni_env_ext</span><span class="p">(</span>
</span><span class='line'>      <span class="n">JNIEnvExt</span><span class="o">::</span><span class="n">Create</span><span class="p">(</span><span class="n">child_thread</span><span class="p">,</span> <span class="n">Runtime</span><span class="o">::</span><span class="n">Current</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">GetJavaVM</span><span class="p">(),</span> <span class="o">&amp;</span><span class="n">error_msg</span><span class="p">));</span>
</span><span class='line'>
</span><span class='line'>  <span class="kt">int</span> <span class="n">pthread_create_result</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'>  <span class="k">if</span> <span class="p">(</span><span class="n">child_jni_env_ext</span><span class="p">.</span><span class="n">get</span><span class="p">()</span> <span class="o">!=</span> <span class="n">nullptr</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="n">pthread_t</span> <span class="n">new_pthread</span><span class="p">;</span>
</span><span class='line'>    <span class="n">pthread_attr_t</span> <span class="n">attr</span><span class="p">;</span>
</span><span class='line'>    <span class="n">child_thread</span><span class="o">-&gt;</span><span class="n">tlsPtr_</span><span class="p">.</span><span class="n">tmp_jni_env</span> <span class="o">=</span> <span class="n">child_jni_env_ext</span><span class="p">.</span><span class="n">get</span><span class="p">();</span>
</span><span class='line'>    <span class="n">CHECK_PTHREAD_CALL</span><span class="p">(</span><span class="n">pthread_attr_init</span><span class="p">,</span> <span class="p">(</span><span class="o">&amp;</span><span class="n">attr</span><span class="p">),</span> <span class="s">&quot;new thread&quot;</span><span class="p">);</span>
</span><span class='line'>    <span class="n">CHECK_PTHREAD_CALL</span><span class="p">(</span><span class="n">pthread_attr_setdetachstate</span><span class="p">,</span> <span class="p">(</span><span class="o">&amp;</span><span class="n">attr</span><span class="p">,</span> <span class="n">PTHREAD_CREATE_DETACHED</span><span class="p">),</span>
</span><span class='line'>                       <span class="s">&quot;PTHREAD_CREATE_DETACHED&quot;</span><span class="p">);</span>
</span><span class='line'>    <span class="n">CHECK_PTHREAD_CALL</span><span class="p">(</span><span class="n">pthread_attr_setstacksize</span><span class="p">,</span> <span class="p">(</span><span class="o">&amp;</span><span class="n">attr</span><span class="p">,</span> <span class="n">stack_size</span><span class="p">),</span> <span class="n">stack_size</span><span class="p">);</span>
</span><span class='line'>    <span class="n">pthread_create_result</span> <span class="o">=</span> <span class="n">pthread_create</span><span class="p">(</span><span class="o">&amp;</span><span class="n">new_pthread</span><span class="p">,</span>
</span><span class='line'>                                           <span class="o">&amp;</span><span class="n">attr</span><span class="p">,</span>
</span><span class='line'>                                           <span class="n">Thread</span><span class="o">::</span><span class="n">CreateCallback</span><span class="p">,</span>
</span><span class='line'>                                           <span class="n">child_thread</span><span class="p">);</span>
</span><span class='line'>    <span class="n">CHECK_PTHREAD_CALL</span><span class="p">(</span><span class="n">pthread_attr_destroy</span><span class="p">,</span> <span class="p">(</span><span class="o">&amp;</span><span class="n">attr</span><span class="p">),</span> <span class="s">&quot;new thread&quot;</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span><span class="n">pthread_create_result</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="c1">// pthread_create started the new thread. The child is now responsible for managing the</span>
</span><span class='line'>      <span class="c1">// JNIEnvExt we created.</span>
</span><span class='line'>      <span class="c1">// Note: we can&#39;t check for tmp_jni_env == nullptr, as that would require synchronization</span>
</span><span class='line'>      <span class="c1">//       between the threads.</span>
</span><span class='line'>      <span class="n">child_jni_env_ext</span><span class="p">.</span><span class="n">release</span><span class="p">();</span>
</span><span class='line'>      <span class="k">return</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">// Either JNIEnvExt::Create or pthread_create(3) failed, so clean up.</span>
</span><span class='line'>  <span class="p">{</span>
</span><span class='line'>    <span class="n">MutexLock</span> <span class="n">mu</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="o">*</span><span class="n">Locks</span><span class="o">::</span><span class="n">runtime_shutdown_lock_</span><span class="p">);</span>
</span><span class='line'>    <span class="n">runtime</span><span class="o">-&gt;</span><span class="n">EndThreadBirth</span><span class="p">();</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>  <span class="c1">// Manually delete the global reference since Thread::Init will not have been run.</span>
</span><span class='line'>  <span class="n">env</span><span class="o">-&gt;</span><span class="n">DeleteGlobalRef</span><span class="p">(</span><span class="n">child_thread</span><span class="o">-&gt;</span><span class="n">tlsPtr_</span><span class="p">.</span><span class="n">jpeer</span><span class="p">);</span>
</span><span class='line'>  <span class="n">child_thread</span><span class="o">-&gt;</span><span class="n">tlsPtr_</span><span class="p">.</span><span class="n">jpeer</span> <span class="o">=</span> <span class="n">nullptr</span><span class="p">;</span>
</span><span class='line'>  <span class="k">delete</span> <span class="n">child_thread</span><span class="p">;</span>
</span><span class='line'>  <span class="n">child_thread</span> <span class="o">=</span> <span class="n">nullptr</span><span class="p">;</span>
</span><span class='line'>  <span class="c1">// TODO: remove from thread group?</span>
</span><span class='line'>  <span class="n">env</span><span class="o">-&gt;</span><span class="n">SetLongField</span><span class="p">(</span><span class="n">java_peer</span><span class="p">,</span> <span class="n">WellKnownClasses</span><span class="o">::</span><span class="n">java_lang_Thread_nativePeer</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
</span><span class='line'>  <span class="p">{</span>
</span><span class='line'>    <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">msg</span><span class="p">(</span><span class="n">child_jni_env_ext</span><span class="p">.</span><span class="n">get</span><span class="p">()</span> <span class="o">==</span> <span class="n">nullptr</span> <span class="o">?</span>
</span><span class='line'>        <span class="n">StringPrintf</span><span class="p">(</span><span class="s">&quot;Could not allocate JNI Env: %s&quot;</span><span class="p">,</span> <span class="n">error_msg</span><span class="p">.</span><span class="n">c_str</span><span class="p">())</span> <span class="o">:</span>
</span><span class='line'>        <span class="n">StringPrintf</span><span class="p">(</span><span class="s">&quot;pthread_create (%s stack) failed: %s&quot;</span><span class="p">,</span>
</span><span class='line'>                                 <span class="n">PrettySize</span><span class="p">(</span><span class="n">stack_size</span><span class="p">).</span><span class="n">c_str</span><span class="p">(),</span> <span class="n">strerror</span><span class="p">(</span><span class="n">pthread_create_result</span><span class="p">)));</span>
</span><span class='line'>    <span class="n">ScopedObjectAccess</span> <span class="n">soa</span><span class="p">(</span><span class="n">env</span><span class="p">);</span>
</span><span class='line'>    <span class="n">soa</span><span class="p">.</span><span class="n">Self</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">ThrowOutOfMemoryError</span><span class="p">(</span><span class="n">msg</span><span class="p">.</span><span class="n">c_str</span><span class="p">());</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>一大堆代码只需要记住进行了<code>pthread_create</code>系统调用即可。</p>

<h3>线程状态</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
<span class='line-number'>98</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="cm">/**</span>
</span><span class='line'><span class="cm">     * A thread state.  A thread can be in one of the following states:</span>
</span><span class='line'><span class="cm">     * &lt;ul&gt;</span>
</span><span class='line'><span class="cm">     * &lt;li&gt;{@link #NEW}&lt;br&gt;</span>
</span><span class='line'><span class="cm">     *     A thread that has not yet started is in this state.</span>
</span><span class='line'><span class="cm">     *     &lt;/li&gt;</span>
</span><span class='line'><span class="cm">     * &lt;li&gt;{@link #RUNNABLE}&lt;br&gt;</span>
</span><span class='line'><span class="cm">     *     A thread executing in the Java virtual machine is in this state.</span>
</span><span class='line'><span class="cm">     *     &lt;/li&gt;</span>
</span><span class='line'><span class="cm">     * &lt;li&gt;{@link #BLOCKED}&lt;br&gt;</span>
</span><span class='line'><span class="cm">     *     A thread that is blocked waiting for a monitor lock</span>
</span><span class='line'><span class="cm">     *     is in this state.</span>
</span><span class='line'><span class="cm">     *     &lt;/li&gt;</span>
</span><span class='line'><span class="cm">     * &lt;li&gt;{@link #WAITING}&lt;br&gt;</span>
</span><span class='line'><span class="cm">     *     A thread that is waiting indefinitely for another thread to</span>
</span><span class='line'><span class="cm">     *     perform a particular action is in this state.</span>
</span><span class='line'><span class="cm">     *     &lt;/li&gt;</span>
</span><span class='line'><span class="cm">     * &lt;li&gt;{@link #TIMED_WAITING}&lt;br&gt;</span>
</span><span class='line'><span class="cm">     *     A thread that is waiting for another thread to perform an action</span>
</span><span class='line'><span class="cm">     *     for up to a specified waiting time is in this state.</span>
</span><span class='line'><span class="cm">     *     &lt;/li&gt;</span>
</span><span class='line'><span class="cm">     * &lt;li&gt;{@link #TERMINATED}&lt;br&gt;</span>
</span><span class='line'><span class="cm">     *     A thread that has exited is in this state.</span>
</span><span class='line'><span class="cm">     *     &lt;/li&gt;</span>
</span><span class='line'><span class="cm">     * &lt;/ul&gt;</span>
</span><span class='line'><span class="cm">     *</span>
</span><span class='line'><span class="cm">     * &lt;p&gt;</span>
</span><span class='line'><span class="cm">     * A thread can be in only one state at a given point in time.</span>
</span><span class='line'><span class="cm">     * These states are virtual machine states which do not reflect</span>
</span><span class='line'><span class="cm">     * any operating system thread states.</span>
</span><span class='line'><span class="cm">     *</span>
</span><span class='line'><span class="cm">     * @since   1.5</span>
</span><span class='line'><span class="cm">     * @see #getState</span>
</span><span class='line'><span class="cm">     */</span>
</span><span class='line'>    <span class="kd">public</span> <span class="kd">enum</span> <span class="n">State</span> <span class="o">{</span>
</span><span class='line'>        <span class="cm">/**</span>
</span><span class='line'><span class="cm">         * Thread state for a thread which has not yet started.</span>
</span><span class='line'><span class="cm">         */</span>
</span><span class='line'>        <span class="n">NEW</span><span class="o">,</span>
</span><span class='line'>
</span><span class='line'>        <span class="cm">/**</span>
</span><span class='line'><span class="cm">         * Thread state for a runnable thread.  A thread in the runnable</span>
</span><span class='line'><span class="cm">         * state is executing in the Java virtual machine but it may</span>
</span><span class='line'><span class="cm">         * be waiting for other resources from the operating system</span>
</span><span class='line'><span class="cm">         * such as processor.</span>
</span><span class='line'><span class="cm">         */</span>
</span><span class='line'>        <span class="n">RUNNABLE</span><span class="o">,</span>
</span><span class='line'>
</span><span class='line'>        <span class="cm">/**</span>
</span><span class='line'><span class="cm">         * Thread state for a thread blocked waiting for a monitor lock.</span>
</span><span class='line'><span class="cm">         * A thread in the blocked state is waiting for a monitor lock</span>
</span><span class='line'><span class="cm">         * to enter a synchronized block/method or</span>
</span><span class='line'><span class="cm">         * reenter a synchronized block/method after calling</span>
</span><span class='line'><span class="cm">         * {@link Object#wait() Object.wait}.</span>
</span><span class='line'><span class="cm">         */</span>
</span><span class='line'>        <span class="n">BLOCKED</span><span class="o">,</span>
</span><span class='line'>
</span><span class='line'>        <span class="cm">/**</span>
</span><span class='line'><span class="cm">         * Thread state for a waiting thread.</span>
</span><span class='line'><span class="cm">         * A thread is in the waiting state due to calling one of the</span>
</span><span class='line'><span class="cm">         * following methods:</span>
</span><span class='line'><span class="cm">         * &lt;ul&gt;</span>
</span><span class='line'><span class="cm">         *   &lt;li&gt;{@link Object#wait() Object.wait} with no timeout&lt;/li&gt;</span>
</span><span class='line'><span class="cm">         *   &lt;li&gt;{@link #join() Thread.join} with no timeout&lt;/li&gt;</span>
</span><span class='line'><span class="cm">         *   &lt;li&gt;{@link LockSupport#park() LockSupport.park}&lt;/li&gt;</span>
</span><span class='line'><span class="cm">         * &lt;/ul&gt;</span>
</span><span class='line'><span class="cm">         *</span>
</span><span class='line'><span class="cm">         * &lt;p&gt;A thread in the waiting state is waiting for another thread to</span>
</span><span class='line'><span class="cm">         * perform a particular action.</span>
</span><span class='line'><span class="cm">         *</span>
</span><span class='line'><span class="cm">         * For example, a thread that has called &lt;tt&gt;Object.wait()&lt;/tt&gt;</span>
</span><span class='line'><span class="cm">         * on an object is waiting for another thread to call</span>
</span><span class='line'><span class="cm">         * &lt;tt&gt;Object.notify()&lt;/tt&gt; or &lt;tt&gt;Object.notifyAll()&lt;/tt&gt; on</span>
</span><span class='line'><span class="cm">         * that object. A thread that has called &lt;tt&gt;Thread.join()&lt;/tt&gt;</span>
</span><span class='line'><span class="cm">         * is waiting for a specified thread to terminate.</span>
</span><span class='line'><span class="cm">         */</span>
</span><span class='line'>        <span class="n">WAITING</span><span class="o">,</span>
</span><span class='line'>
</span><span class='line'>        <span class="cm">/**</span>
</span><span class='line'><span class="cm">         * Thread state for a waiting thread with a specified waiting time.</span>
</span><span class='line'><span class="cm">         * A thread is in the timed waiting state due to calling one of</span>
</span><span class='line'><span class="cm">         * the following methods with a specified positive waiting time:</span>
</span><span class='line'><span class="cm">         * &lt;ul&gt;</span>
</span><span class='line'><span class="cm">         *   &lt;li&gt;{@link #sleep Thread.sleep}&lt;/li&gt;</span>
</span><span class='line'><span class="cm">         *   &lt;li&gt;{@link Object#wait(long) Object.wait} with timeout&lt;/li&gt;</span>
</span><span class='line'><span class="cm">         *   &lt;li&gt;{@link #join(long) Thread.join} with timeout&lt;/li&gt;</span>
</span><span class='line'><span class="cm">         *   &lt;li&gt;{@link LockSupport#parkNanos LockSupport.parkNanos}&lt;/li&gt;</span>
</span><span class='line'><span class="cm">         *   &lt;li&gt;{@link LockSupport#parkUntil LockSupport.parkUntil}&lt;/li&gt;</span>
</span><span class='line'><span class="cm">         * &lt;/ul&gt;</span>
</span><span class='line'><span class="cm">         */</span>
</span><span class='line'>        <span class="n">TIMED_WAITING</span><span class="o">,</span>
</span><span class='line'>
</span><span class='line'>        <span class="cm">/**</span>
</span><span class='line'><span class="cm">         * Thread state for a terminated thread.</span>
</span><span class='line'><span class="cm">         * The thread has completed execution.</span>
</span><span class='line'><span class="cm">         */</span>
</span><span class='line'>        <span class="n">TERMINATED</span><span class="o">;</span>
</span><span class='line'>    <span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>线程有6种状态，<code>NEW</code>表示线程新建，还没调用<code>start()</code>。<code>RUNNABLE</code>表示线程调用了<code>start</code>处于可运行状态，等待CPU调度。<code>BLOCKED</code>表示线程在等待获取monitor lock。当在线程中调用<code>Object.wait()</code>或<code>Thread.join()</code>或<code>LockSupport.park()</code>方法时线程进入<code>WAITING</code>状态，在线程中调用<code>Thread.sleep()</code>或<code>Object.wait(long)</code>或<code>Thread.join(long)</code>或<code>LockSupport.parkNanos(long)</code>或<code>LockSupport.parkUntil(long)</code>线程进入<code>TIMED_WAITING</code>状态。线程执行完操作后会进入<code>TERMINATED</code>状态。</p>

<h3>线程中断</h3>

<p>线程中一共有3个和中断有关的方法，分别是<code>interrupt()</code>，<code>isInterrupted()</code>和静态方法<code>interrupted</code>。我们分别看一下。</p>

<h4>interrupt</h4>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="cm">/**</span>
</span><span class='line'><span class="cm">     * Interrupts this thread.</span>
</span><span class='line'><span class="cm">     *</span>
</span><span class='line'><span class="cm">     * &lt;p&gt; Unless the current thread is interrupting itself, which is</span>
</span><span class='line'><span class="cm">     * always permitted, the {@link #checkAccess() checkAccess} method</span>
</span><span class='line'><span class="cm">     * of this thread is invoked, which may cause a {@link</span>
</span><span class='line'><span class="cm">     * SecurityException} to be thrown.</span>
</span><span class='line'><span class="cm">     *</span>
</span><span class='line'><span class="cm">     * &lt;p&gt; If this thread is blocked in an invocation of the {@link</span>
</span><span class='line'><span class="cm">     * Object#wait() wait()}, {@link Object#wait(long) wait(long)}, or {@link</span>
</span><span class='line'><span class="cm">     * Object#wait(long, int) wait(long, int)} methods of the {@link Object}</span>
</span><span class='line'><span class="cm">     * class, or of the {@link #join()}, {@link #join(long)}, {@link</span>
</span><span class='line'><span class="cm">     * #join(long, int)}, {@link #sleep(long)}, or {@link #sleep(long, int)},</span>
</span><span class='line'><span class="cm">     * methods of this class, then its interrupt status will be cleared and it</span>
</span><span class='line'><span class="cm">     * will receive an {@link InterruptedException}.</span>
</span><span class='line'><span class="cm">     *</span>
</span><span class='line'><span class="cm">     * &lt;p&gt; If this thread is blocked in an I/O operation upon an {@link</span>
</span><span class='line'><span class="cm">     * java.nio.channels.InterruptibleChannel InterruptibleChannel}</span>
</span><span class='line'><span class="cm">     * then the channel will be closed, the thread&#39;s interrupt</span>
</span><span class='line'><span class="cm">     * status will be set, and the thread will receive a {@link</span>
</span><span class='line'><span class="cm">     * java.nio.channels.ClosedByInterruptException}.</span>
</span><span class='line'><span class="cm">     *</span>
</span><span class='line'><span class="cm">     * &lt;p&gt; If this thread is blocked in a {@link java.nio.channels.Selector}</span>
</span><span class='line'><span class="cm">     * then the thread&#39;s interrupt status will be set and it will return</span>
</span><span class='line'><span class="cm">     * immediately from the selection operation, possibly with a non-zero</span>
</span><span class='line'><span class="cm">     * value, just as if the selector&#39;s {@link</span>
</span><span class='line'><span class="cm">     * java.nio.channels.Selector#wakeup wakeup} method were invoked.</span>
</span><span class='line'><span class="cm">     *</span>
</span><span class='line'><span class="cm">     * &lt;p&gt; If none of the previous conditions hold then this thread&#39;s interrupt</span>
</span><span class='line'><span class="cm">     * status will be set. &lt;/p&gt;</span>
</span><span class='line'><span class="cm">     *</span>
</span><span class='line'><span class="cm">     * &lt;p&gt; Interrupting a thread that is not alive need not have any effect.</span>
</span><span class='line'><span class="cm">     *</span>
</span><span class='line'><span class="cm">     * @throws  SecurityException</span>
</span><span class='line'><span class="cm">     *          if the current thread cannot modify this thread</span>
</span><span class='line'><span class="cm">     *</span>
</span><span class='line'><span class="cm">     * @revised 6.0</span>
</span><span class='line'><span class="cm">     * @spec JSR-51</span>
</span><span class='line'><span class="cm">     */</span>
</span><span class='line'>    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">interrupt</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>        <span class="k">if</span> <span class="o">(</span><span class="k">this</span> <span class="o">!=</span> <span class="n">Thread</span><span class="o">.</span><span class="na">currentThread</span><span class="o">())</span>
</span><span class='line'>            <span class="n">checkAccess</span><span class="o">();</span>
</span><span class='line'>
</span><span class='line'>        <span class="kd">synchronized</span> <span class="o">(</span><span class="n">blockerLock</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>            <span class="n">Interruptible</span> <span class="n">b</span> <span class="o">=</span> <span class="n">blocker</span><span class="o">;</span>
</span><span class='line'>            <span class="k">if</span> <span class="o">(</span><span class="n">b</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>                <span class="n">nativeInterrupt</span><span class="o">();</span>
</span><span class='line'>                <span class="n">b</span><span class="o">.</span><span class="na">interrupt</span><span class="o">(</span><span class="k">this</span><span class="o">);</span>
</span><span class='line'>                <span class="k">return</span><span class="o">;</span>
</span><span class='line'>            <span class="o">}</span>
</span><span class='line'>        <span class="o">}</span>
</span><span class='line'>        <span class="n">nativeInterrupt</span><span class="o">();</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>  <span class="nd">@FastNative</span>
</span><span class='line'>    <span class="kd">private</span> <span class="kd">native</span> <span class="kt">void</span> <span class="nf">nativeInterrupt</span><span class="o">();</span>
</span></code></pre></td></tr></table></div></figure>


<p>从注释我们可以看出调用Thread的<code>interrupt</code>方法，分为几种情况</p>

<ul>
<li>如果线程阻塞在<code>Object.wait()</code>、<code>Object.wait(long)</code>、<code>Object.wait(long,int)</code>、<code>Thread.join()</code>、<code>Thread.join(long)</code>、<code>Thread.join(long,int)</code>、<code>Thread.sleep(long)</code>、<code>Thread.sleep(long,int)</code>这些方法上，线程的中断状态将被清除，并抛出<code>InterruptedException</code>。</li>
<li>如果阻塞在<code>java.nio.channels.InterruptibleChannel</code>IO操作操作上，线程的中断状态将被设置（这里有个疑惑，这里设置是指设置为true还是false，如果设置为false就表示线程状态被清除了，由于对NIO了解不多，这里暂时无法确定，从注释上下文理解应该是设置为true了）并抛出<code>java.nio.channels.ClosedByInterruptException</code></li>
<li>如果阻塞在<code>java.nio.channels.Selector</code>上，线程的中断状态将被设置，并从<code>Selector</code>操作中返回。</li>
<li>如果是其他情况，比如正在执行不会响应<code>interrupt</code>方法的方法（如<code>Socket</code>的读写或<code>ServerSocket</code>的<code>accept</code>），那么线程的中断状态将被设置。</li>
</ul>


<p>继续看<code>nativeInterrupt</code>方法，从<a href="http://androidxref.com/9.0.0_r3/xref/art/runtime/native/java_lang_Thread.cc">java_lang_thread.cc</a>中<a href="http://androidxref.com/9.0.0_r3/xref/art/runtime/native/java_lang_Thread.cc#126">Thread_nativeInterupt</a>可以看到是调用了<a href="http://androidxref.com/9.0.0_r3/xref/art/runtime/thread.cc#2416">Thread::Interrupt</a>。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='c++'><span class='line'><span class="c1">// http://androidxref.com/9.0.0_r3/xref/art/runtime/thread.cc#2416</span>
</span><span class='line'><span class="kt">void</span> <span class="n">Thread</span><span class="o">::</span><span class="n">Interrupt</span><span class="p">(</span><span class="n">Thread</span><span class="o">*</span> <span class="n">self</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="n">MutexLock</span> <span class="n">mu</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="o">*</span><span class="n">wait_mutex_</span><span class="p">);</span>
</span><span class='line'>  <span class="k">if</span> <span class="p">(</span><span class="n">tls32_</span><span class="p">.</span><span class="n">interrupted</span><span class="p">.</span><span class="n">LoadSequentiallyConsistent</span><span class="p">())</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">return</span><span class="p">;</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>  <span class="n">tls32_</span><span class="p">.</span><span class="n">interrupted</span><span class="p">.</span><span class="n">StoreSequentiallyConsistent</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
</span><span class='line'>  <span class="n">NotifyLocked</span><span class="p">(</span><span class="n">self</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>可以看到只是设置了一下中断状态。</p>

<h4>isInterrupted 和 interrupted</h4>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="cm">/**</span>
</span><span class='line'><span class="cm"> * Tests whether this thread has been interrupted.  The &lt;i&gt;interrupted</span>
</span><span class='line'><span class="cm"> * status&lt;/i&gt; of the thread is unaffected by this method.</span>
</span><span class='line'><span class="cm"> *</span>
</span><span class='line'><span class="cm"> * &lt;p&gt;A thread interruption ignored because a thread was not alive</span>
</span><span class='line'><span class="cm"> * at the time of the interrupt will be reflected by this method</span>
</span><span class='line'><span class="cm"> * returning false.</span>
</span><span class='line'><span class="cm"> *</span>
</span><span class='line'><span class="cm"> * @return  &lt;code&gt;true&lt;/code&gt; if this thread has been interrupted;</span>
</span><span class='line'><span class="cm"> *          &lt;code&gt;false&lt;/code&gt; otherwise.</span>
</span><span class='line'><span class="cm"> * @see     #interrupted()</span>
</span><span class='line'><span class="cm"> * @revised 6.0</span>
</span><span class='line'><span class="cm"> */</span>
</span><span class='line'><span class="nd">@FastNative</span>
</span><span class='line'><span class="kd">public</span> <span class="kd">native</span> <span class="kt">boolean</span> <span class="nf">isInterrupted</span><span class="o">();</span> <span class="c1">// 实例方法，返回中断状态</span>
</span><span class='line'>
</span><span class='line'><span class="cm">/**</span>
</span><span class='line'><span class="cm"> * Tests whether the current thread has been interrupted.  The</span>
</span><span class='line'><span class="cm"> * &lt;i&gt;interrupted status&lt;/i&gt; of the thread is cleared by this method.  In</span>
</span><span class='line'><span class="cm"> * other words, if this method were to be called twice in succession, the</span>
</span><span class='line'><span class="cm"> * second call would return false (unless the current thread were</span>
</span><span class='line'><span class="cm"> * interrupted again, after the first call had cleared its interrupted</span>
</span><span class='line'><span class="cm"> * status and before the second call had examined it).</span>
</span><span class='line'><span class="cm"> *</span>
</span><span class='line'><span class="cm"> * &lt;p&gt;A thread interruption ignored because a thread was not alive</span>
</span><span class='line'><span class="cm"> * at the time of the interrupt will be reflected by this method</span>
</span><span class='line'><span class="cm"> * returning false.</span>
</span><span class='line'><span class="cm"> *</span>
</span><span class='line'><span class="cm"> * @return  &lt;code&gt;true&lt;/code&gt; if the current thread has been interrupted;</span>
</span><span class='line'><span class="cm"> *          &lt;code&gt;false&lt;/code&gt; otherwise.</span>
</span><span class='line'><span class="cm"> * @see #isInterrupted()</span>
</span><span class='line'><span class="cm"> * @revised 6.0</span>
</span><span class='line'><span class="cm"> */</span>
</span><span class='line'><span class="nd">@FastNative</span>
</span><span class='line'><span class="kd">public</span> <span class="kd">static</span> <span class="kd">native</span> <span class="kt">boolean</span> <span class="nf">interrupted</span><span class="o">();</span>
</span></code></pre></td></tr></table></div></figure>


<p>实例方法<code>isInterrupted</code>会返回线程的中断状态，静态方法<code>interrupted</code>会返回调用这个方法的线程的中断状态，并清除线程的中断状态，这也是清除中断状态的唯一方法，设置中断状态当然调用<code>interrupt</code>方法就好了。</p>

<p>不妨看下native层实现：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class='c++'><span class='line'><span class="c1">// http://androidxref.com/9.0.0_r3/xref/art/runtime/thread.cc</span>
</span><span class='line'><span class="c1">// Implements java.lang.Thread.interrupted.</span>
</span><span class='line'><span class="kt">bool</span> <span class="n">Thread</span><span class="o">::</span><span class="n">Interrupted</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>  <span class="n">DCHECK_EQ</span><span class="p">(</span><span class="n">Thread</span><span class="o">::</span><span class="n">Current</span><span class="p">(),</span> <span class="k">this</span><span class="p">);</span>
</span><span class='line'>  <span class="c1">// No other thread can concurrently reset the interrupted flag.</span>
</span><span class='line'>  <span class="kt">bool</span> <span class="n">interrupted</span> <span class="o">=</span> <span class="n">tls32_</span><span class="p">.</span><span class="n">interrupted</span><span class="p">.</span><span class="n">LoadSequentiallyConsistent</span><span class="p">();</span>
</span><span class='line'>  <span class="k">if</span> <span class="p">(</span><span class="n">interrupted</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="n">tls32_</span><span class="p">.</span><span class="n">interrupted</span><span class="p">.</span><span class="n">StoreSequentiallyConsistent</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>  <span class="k">return</span> <span class="n">interrupted</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// Implements java.lang.Thread.isInterrupted.</span>
</span><span class='line'><span class="kt">bool</span> <span class="n">Thread</span><span class="o">::</span><span class="n">IsInterrupted</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>  <span class="k">return</span> <span class="n">tls32_</span><span class="p">.</span><span class="n">interrupted</span><span class="p">.</span><span class="n">LoadSequentiallyConsistent</span><span class="p">();</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<h3>守护线程</h3>

<p>线程可分为两种，普通线程和守护线程（其实叫服务线程好理解些，这些线程一般是服务其他线程的）。在JVM启动时创建的所有线程中，除了主线程以外，其他的线程都是守护线程（例如垃圾回收器以及执行其他辅助工作的线程，signal catcher之类的）。</p>

<p>当创建一个新线程时，新线程将继承创建它的线程的守护状态。</p>

<p>普通线程和守护线程之间的差异仅在于当线程退出时发生的操作。当一个线程退出时，JVM会检查其他正在运行的线程，如果这些线程都是守护线程，那么JVM会正常退出操作。当JVM停止时，所有仍然存在的守护线程都将被抛弃——既不会执行finally代码块，也不会执行回卷栈，而JVM只是直接退出。</p>

<h3>reference</h3>

<ul>
<li>《Java并发编程实战》</li>
<li><a href="http://gityuan.com/2016/09/24/android-thread/">Android平台上除了Java线程还有native线程，可以参考这篇</a></li>
</ul>

</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Solarex</span></span>

      








  


<time datetime="2019-05-28T16:58:00+08:00" pubdate data-updated="true">May 28<span>th</span>, 2019</time>
      

<span class="categories">
  
    <a class='category' href='/blog/categories/concurrency/'>concurrency</a>, <a class='category' href='/blog/categories/java/'>java</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/blog/2019/04/30/learning-dagger2/" title="Previous Post: Dagger2学习">&laquo; Dagger2学习</a>
      
      
        <a class="basic-alignment right" href="/blog/2019/06/28/futuretask/" title="Next Post: Java FutureTask解析">Java FutureTask解析 &raquo;</a>
      
    </p>
  </footer>
</article>

  <section>
    <h1>Comments</h1>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
  </section>

</div>

<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2019/08/04/java-threadpoolexecutor/">Java线程池解析</a>
      </li>
    
      <li class="post">
        <a href="/blog/2019/08/01/java-blockingqueue/">Java BlockingQueue解析</a>
      </li>
    
      <li class="post">
        <a href="/blog/2019/07/28/aqs/">Java AQS解析</a>
      </li>
    
      <li class="post">
        <a href="/blog/2019/06/28/futuretask/">Java FutureTask解析</a>
      </li>
    
      <li class="post">
        <a href="/blog/2019/05/28/thread/">Android Thread解析</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating...</li>
  </ul>
  
  <a href="https://github.com/flyfire">@flyfire</a> on GitHub
  
  <script type="text/javascript">
    $(document).ready(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'flyfire',
            count: 5,
            skip_forks: false,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>



<section class="googleplus googleplus-hidden">
  <h1>
    <a href="https://plus.google.com/107384356964511479070?rel=author">
      <img src="http://www.google.com/images/icons/ui/gprofile_button-32.png" width="32" height="32">
      Google+
    </a>
  </h1>
</section>



  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2019 - Solarex -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
  - <span class="credit">Theme by <a href="http://www.gehaxelt.in">Gehaxelt</a></span>
  <span class="credit">and <a href="http://www.it-solutions-neef.de">IT Solutions Neef</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'solarex-blog';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://Solarex.github.io/blog/2019/05/28/thread/';
        var disqus_url = 'http://Solarex.github.io/blog/2019/05/28/thread/';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>











</body>
</html>
